services:
  node1:
    build: .
    ports:
      - "9001:9001"
    volumes:
      - ./output/1:/app/conf
    environment:
      - ID=1
      - PORT=9001
      - PEERS=2|node2:9002,3|node3:9003
      - DROP_RATE=0.1
      - PARTITION=true
      - PARTITION_INTERVAL_MS=2000
      - PARTITION_OUTAGE_MS=200
  node2:
    build: .
    ports:
      - "9002:9002"
    volumes:
      - ./output/2:/app/conf
    environment:
      - ID=2
      - PORT=9002
      - PEERS=1|node1:9001,3|node3:9003
      - DROP_RATE=0.2
      - PARTITION=true
      - PARTITION_INTERVAL_MS=2000
      - PARTITION_OUTAGE_MS=200
  node3:
    build: .
    ports:
      - "9003:9003"
    volumes:
      - ./output/3:/app/conf
    environment:
      - ID=3
      - PORT=9003
      - PEERS=1|node1:9001,2|node2:9002
      - DROP_RATE=0.1
      - PARTITION=true
      - PARTITION_INTERVAL_MS=2000
      - PARTITION_OUTAGE_MS=200
  client:
    build: .
    environment:
      - PEERS=1|node1:9001,2|node2:9002,3|node3:9003
      - CLIENT=true
      - REQUESTS=100
      - WAIT_BETWEEN_REQUEST_MS=200